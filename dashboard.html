<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Time Buddy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dashboard-style.css">
</head>
<body>
    <div class="container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-clock"></i>
                    <span>Time Buddy</span>
                </div>
            </div>
            
            <nav class="nav-menu">
                <a href="dashboard.html" class="nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="timetable.html" class="nav-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Timetable</span>
                </a>
                <a href="group.html" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Groups</span>
                </a>
                <a href="lecturer.html" class="nav-item">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span>Lecturer Consult</span>
                </a>
                <a href="notification.html" class="nav-item">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </a>
            </nav>
            
            <div class="nav-item" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="dashboard-container">
                <!-- Dashboard Header -->
                <div class="dashboard-header">
                    <h1>Dashboard</h1>
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="Search...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <!-- Welcome Section -->
                <div class="welcome-section">
                    <h2>Welcome back, Student!</h2>
                    <p>Here's what's happening with your schedule today.</p>
                </div>

                <!-- Activity Cards -->
                <div class="activity-cards">
                    <div class="activity-card upcoming">
                        <div class="card-header">
                            <h3>Upcoming Classes</h3>
                            <p class="card-subtitle">Today's schedule</p>
                        </div>
                        <div class="card-content">
                            <p>Web Development - 10:00 AM</p>
                            <p>Multimedia Systems - 2:00 PM</p>
                        </div>
                    </div>

                    <div class="activity-card group">
                        <div class="card-header">
                            <h3>Study Groups</h3>
                            <p class="card-subtitle">Active groups</p>
                        </div>
                        <div class="card-content">
                            <p>Web Dev Group - 3 members</p>
                            <p>Multimedia Group - 5 members</p>
                        </div>
                    </div>

                    <div class="activity-card lecturer">
                        <div class="card-header">
                            <h3>Lecturer Consultations</h3>
                            <p class="card-subtitle">Upcoming meetings</p>
                        </div>
                        <div class="card-content">
                            <p>Dr. Smith - Tomorrow 3:00 PM</p>
                            <p>Prof. Johnson - Friday 11:00 AM</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="recent-activity">
                    <h3>Recent Activity</h3>
                    
                    <div class="activity-item">
                        <div class="activity-icon meeting">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="activity-details">
                            <h4>Group Meeting <span class="activity-status">- Web Development</span></h4>
                            <p class="activity-time">Today, 2:30 PM - 4:00 PM</p>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon consultation">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="activity-details">
                            <h4>Consultation <span class="activity-status">- Dr. Smith</span></h4>
                            <p class="activity-time">Tomorrow, 3:00 PM - 3:30 PM</p>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon meeting">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="activity-details">
                            <h4>Online Class <span class="activity-status">- Multimedia Systems</span></h4>
                            <p class="activity-time">Yesterday, 9:00 AM - 10:30 AM</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    
    <!-- Auth Functions -->
    <script>
        // Initialize Firebase with proper checking
        console.log('Initializing Firebase for dashboard...');
        
        // Use window object to avoid variable conflicts
        if (!window.firebaseApp) {
            window.firebaseApp = firebase.initializeApp(firebaseConfig);
            console.log('New Firebase app initialized for dashboard');
        } else {
            console.log('Using existing Firebase app');
        }
        
        // Initialize auth and db on window object
        window.auth = firebase.auth();
        window.db = firebase.firestore();

        // Make logout function globally available
        window.logout = function() {
            window.auth.signOut().then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('Logout error:', error);
            });
        }

        // Auth state change listener
        window.auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in, get user data
                window.db.collection('users').doc(user.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        document.querySelector('.welcome-section h2').textContent = 
                            `Welcome back, ${userData.name || 'Student'}!`;
                    }
                })
                .catch((error) => {
                    console.log("Error getting user document:", error);
                });
        
                // Get user's upcoming classes
                getUpcomingClasses(user.uid);
            } else {
                window.location.href = 'index.html';
            }
        });

        function getUpcomingClasses(userId) {
            // This would query your timetable data from Firestore
            console.log("Getting upcoming classes for user:", userId);
        }
    </script>
</body>
</html>
